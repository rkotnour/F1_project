--Which countries host the most races?
SELECT COUNT(c.country) AS total_races,
	   c.country
FROM circuits AS c
JOIN races AS r
ON c."circuitId" = r."circuitId"
GROUP BY c.country
ORDER BY total_races DESC;

--Which nation produces the most drivers?
SELECT COUNT(nationality),
	   nationality
FROM drivers
GROUP BY nationality
ORDER BY COUNT(nationality) DESC; 

--Which nations have scored the most points? 
SELECT SUM(cr.points) AS points_total,
	   cs.nationality
FROM constructor_results AS cr
JOIN constructors AS cs
ON cr."constructorId" = cs."constructorId"
GROUP BY cs.nationality
ORDER BY points_total DESC;

--Which constructor has won the most points?
SELECT SUM(cr.points) AS points_total,
	   cs.name
FROM constructor_results AS cr
JOIN constructors AS cs
ON cr."constructorId" = cs."constructorId"
GROUP BY cs.name
ORDER BY points_total DESC;

--Which constructor has won the most podiums?
SELECT cs.name,
	   COUNT(rs.position) AS total_podiums
FROM results AS rs
JOIN constructors AS cs
ON rs."constructorId" = cs."constructorId"
WHERE rs.position IN ('1', '2', '3')
GROUP BY cs.name
ORDER BY total_podiums DESC;

--What is the average age of drivers? 
--Needed to modify drivers table, as original date format not a usable data type format 
ALTER TABLE drivers ADD COLUMN IF NOT EXISTS dob_update DATE;

CREATE TEMPORARY TABLE drivers_update (
	driver_id INT, 
	dob_update DATE
);
--Started by cleaing dates from drivers csv
--converted M/DD/YY to YYYY-MM-DD for all driver IDs
INSERT INTO drivers_update VALUES
(1, '1985-01-07'),
(2, '1977-05-10'),
(3, '1985-06-27'),
(4, '1981-07-29'),
(5, '1981-10-19'),
(6, '1985-01-11'),
(7, '1979-02-28'),
(8, '1979-10-17'),
(9, '1984-12-07'),
(10, '1982-03-18'),
(11, '1977-01-28'),
(12, '1985-07-25'),
(13, '1981-04-25'),
(14, '1971-03-27'),
(15, '1974-07-13'),
(16, '1983-01-11'),
(17, '1976-08-27'),
(18, '1980-01-19'),
(19, '1979-04-18'),
(20, '1987-07-03'),
(21, '1973-01-14'),
(22, '1972-05-23'),
(23, '1975-06-30'),
(24, '1980-08-06'),
(25, '1974-02-15'),
(26, '1983-01-24'),
(27, '1979-04-16'),
(28, '1980-06-13'),
(29, '1982-07-09'),
(30, '1969-01-03'),
(31, '1975-09-20'),
(32, '1983-02-07'),
(33, '1976-07-24'),
(34, '1975-01-21'),
(35, '1971-04-09'),
(36, '1978-01-05'),
(37, '1971-02-24'),
(38, '1981-09-23'),
(39, '1977-01-14'),
(40, '1980-09-26'),
(41, '1976-03-23'),
(42, '1980-09-11'),
(43, '1973-09-19'),
(44, '1966-09-02'),
(45, '1979-02-04'),
(46, '1981-05-30'),
(47, '1981-01-01'),
(48, '1974-03-29'),
(49, '1967-05-18'),
(50, '1972-03-04'),
(51, '1978-07-31'),
(52, '1975-05-20'),
(53, '1978-03-03'),
(54, '1975-03-05'),
(55, '1964-06-11'),
(56, '1965-11-10'),
(57, '1968-09-28'),
(58, '1976-01-19'),
(59, '1978-10-19'),
(60, '1975-05-08'),
(61, '1976-09-11'),
(62, '1976-07-20'),
(63, '1966-11-30'),
(64, '1970-05-22'),
(65, '1964-06-25'),
(66, '1969-12-29'),
(67, '1988-10-31'),
(68, '1974-02-12'),
(69, '1971-01-25'),
(70, '1966-10-23'),
(71, '1960-09-17'),
(72, '1975-11-02'),
(73, '1968-07-27'),
(74, '1978-04-22'),
(75, '1971-04-01'),
(76, '1973-07-04'),
(77, '1959-08-27'),
(78, '1964-03-19'),
(79, '1963-05-29'),
(80, '1966-10-07'),
(81, '1968-01-13'),
(82, '1975-01-20'),
(83, '1972-03-20'),
(84, '1959-06-01'),
(85, '1964-05-30'),
(86, '1958-02-18'),
(87, '1966-04-08'),
(88, '1960-09-08'),
(89, '1963-09-05'),
(90, '1959-02-11'),
(91, '1968-12-20'),
(92, '1962-12-23'),
(93, '1967-11-17'),
(94, '1961-04-23'),
(95, '1953-08-08'),
(96, '1969-12-27'),
(97, '1969-10-03'),
(98, '1963-10-01'),
(99, '1962-03-02'),
(100, '1963-09-28'),
(101, '1965-09-05'),
(102, '1960-03-21'),
(103, '1964-08-24'),
(104, '1971-01-18'),
(105, '1956-12-23'),
(106, '1969-11-23'),
(107, '1960-07-04'),
(108, '1963-04-23'),
(109, '1966-01-31'),
(110, '1959-05-31'),
(111, '1963-01-01'),
(112, '1954-07-27'),
(113, '1969-11-19'),
(114, '1961-07-28'),
(115, '1969-03-07'),
(116, '1968-09-01'),
(117, '1955-02-24'),
(118, '1954-08-27'),
(119, '1954-04-17'),
(120, '1963-04-02'),
(121, '1962-10-05'),
(122, '1963-05-24'),
(123, '1957-07-13'),
(124, '1965-10-07'),
(125, '1968-02-24'),
(126, '1955-03-10'),
(127, '1963-04-20'),
(128, '1961-09-30'),
(129, '1958-09-02'),
(130, '1964-05-06'),
(131, '1963-05-12'),
(132, '1959-07-20'),
(133, '1964-03-18'),
(134, '1964-09-19'),
(135, '1961-03-03'),
(136, '1956-06-02'),
(137, '1952-08-17'),
(138, '1953-02-23'),
(139, '1962-01-12'),
(140, '1956-09-08'),
(141, '1961-10-09'),
(142, '1965-02-27'),
(143, '1968-03-08'),
(144, '1966-06-13'),
(145, '1959-07-07'),
(146, '1964-07-20'),
(147, '1961-04-20'),
(148, '1965-03-27'),
(149, '1960-07-20'),
(150, '1961-03-29'),
(151, '1964-03-26'),
(152, '1952-09-10'),
(153, '1990-03-23'),
(154, '1986-04-17'),
(155, '1986-09-13'),
(156, '1956-11-07'),
(157, '1958-04-04'),
(158, '1958-01-10'),
(159, '1959-05-15'),
(160, '1952-01-16'),
(161, '1962-03-18'),
(162, '1961-05-27'),
(163, '1948-07-04'),
(164, '1960-10-24'),
(165, '1954-08-19'),
(166, '1955-06-26'),
(167, '1960-06-17'),
(168, '1948-09-12'),
(169, '1960-01-09'),
(170, '1955-03-09'),
(171, '1958-09-22'),
(172, '1943-11-21'),
(173, '1958-03-26'),
(174, '1958-04-26'),
(175, '1949-06-25'),
(176, '1951-09-18'),
(177, '1948-12-06'),
(178, '1946-11-02'),
(179, '1954-10-08'),
(180, '1961-08-01'),
(181, '1951-10-06'),
(182, '1949-02-22'),
(183, '1956-12-30'),
(184, '1954-01-31'),
(185, '1957-11-20'),
(186, '1957-11-27'),
(187, '1946-05-04'),
(188, '1956-01-25'),
(189, '1954-01-24'),
(190, '1961-04-12'),
(191, '1961-03-30'),
(192, '1957-02-03'),
(193, '1950-03-09'),
(194, '1954-11-14'),
(195, '1958-11-16'),
(196, '1957-12-04'),
(197, '1946-07-10'),
(198, '1953-11-04'),
(199, '1942-04-12'),
(200, '1946-09-30'),
(201, '1946-11-25'),
(202, '1952-03-26'),
(203, '1950-01-18'),
(204, '1958-06-15'),
(205, '1946-09-19'),
(206, '1953-03-11'),
(207, '1940-02-28'),
(208, '1946-07-26'),
(209, '1951-05-01'),
(210, '1958-05-06'),
(211, '1955-02-26'),
(212, '1956-02-05'),
(213, '1957-01-02'),
(214, '1956-03-31'),
(215, '1953-08-31'),
(216, '1952-10-10'),
(217, '1949-04-13'),
(218, '1949-08-08'),
(219, '1942-10-01'),
(220, '1947-11-08'),
(221, '1944-08-09'),
(222, '1950-01-29'),
(223, '1939-09-05'),
(224, '1946-12-12'),
(225, '1953-01-15'),
(226, '1952-02-19'),
(227, '1951-10-29'),
(228, '1953-11-26'),
(229, '1948-08-31'),
(230, '1937-11-11'),
(231, '1947-08-29'),
(232, '1943-03-11'),
(233, '1951-01-01'),
(234, '1950-01-18'),
(235, '1945-01-01'),
(236, '1952-02-12'),
(237, '1948-11-07'),
(238, '1944-02-14'),
(239, '1945-11-14'),
(240, '1942-05-21'),
(241, '1953-05-24'),
(242, '1944-08-13'),
(243, '1943-07-11'),
(244, '1946-02-23'),
(245, '1943-01-24'),
(246, '1948-06-12'),
(247, '1949-10-02'),
(248, '1938-01-01'),
(249, '1953-01-10'),
(250, '1944-10-06'),
(251, '1947-08-22'),
(252, '1949-06-11'),
(253, '1953-02-28'),
(254, '1946-12-12'),
(255, '1948-11-20'),
(256, '1950-03-18'),
(257, '1949-05-03'),
(258, '1949-10-13'),
(259, '1945-01-26'),
(260, '1939-12-28'),
(261, '1952-09-19'),
(262, '1942-08-14'),
(263, '1948-05-17'),
(264, '1947-05-09'),
(265, '1942-12-30'),
(266, '1945-12-13'),
(267, '1943-03-19'),
(268, '1943-03-16'),
(269, '1942-07-26'),
(270, '1947-10-26'),
(271, '1950-04-01'),
(272, '1940-01-29'),
(273, '1947-07-01'),
(274, '1951-06-06'),
(275, '1941-03-26'),
(276, '1947-06-11'),
(277, '1946-03-18'),
(278, '1943-07-20'),
(279, '1944-05-27'),
(280, '1942-09-25'),
(281, '1944-04-19'),
(282, '1945-11-17'),
(283, '1946-01-07'),
(284, '1942-08-31'),
(285, '1947-03-03'),
(286, '1949-12-24'),
(287, '1945-11-13'),
(288, '1937-03-18'),
(289, '2029-02-15'),
(290, '1943-12-25'),
(291, '1948-12-01'),
(292, '1944-09-12'),
(293, '1936-10-27'),
(294, '1952-03-28'),
(295, '1948-12-12'),
(296, '1944-12-04'),
(297, '1947-07-23'),
(298, '1942-03-16'),
(299, '1946-03-10'),
(300, '1941-10-06'),
(301, '1944-08-07'),
(302, '1948-02-13'),
(303, '1942-05-31'),
(304, '1936-06-18'),
(305, '1940-04-02'),
(306, '1937-04-26'),
(307, '1941-12-24'),
(308, '1944-09-22'),
(309, '1939-02-27'),
(310, '1934-05-13'),
(311, '1942-08-27'),
(312, '1937-03-09'),
(313, '1947-10-14'),
(314, '1943-09-26'),
(315, '1940-05-23'),
(316, '1943-08-05'),
(317, '1941-09-30'),
(318, '1943-10-12'),
(319, '1944-04-26'),
(320, '1940-02-21'),
(321, '1941-10-31'),
(322, '1939-06-09'),
(323, '1939-05-30'),
(324, '1948-11-03'),
(325, '1935-06-26'),
(326, '1938-05-28'),
(327, '1944-02-25'),
(328, '1939-06-11'),
(329, '1940-04-13'),
(330, '1940-10-02'),
(331, '1937-01-16'),
(332, '1934-01-27'),
(333, '1941-10-03'),
(334, '1934-11-22'),
(335, '1948-02-02'),
(336, '1940-03-05'),
(337, '1943-04-27'),
(338, '1941-06-10'),
(339, '1932-10-29'),
(340, '2024-12-07'),
(341, '1934-02-11'),
(342, '1936-11-16'),
(343, '1935-12-26'),
(344, '1944-05-26'),
(345, '1940-01-18'),
(346, '1936-07-07'),
(347, '1930-01-31'),
(348, '1943-02-24'),
(349, '1943-07-27'),
(350, '1935-06-10'),
(351, '1941-04-24'),
(352, '1945-11-12'),
(353, '2026-04-11'),
(354, '1939-11-17'),
(355, '1933-06-21'),
(356, '2026-04-02'),
(357, '1943-06-14'),
(358, '1942-04-18'),
(359, '1942-01-18'),
(360, '1937-08-30'),
(361, '1942-05-27'),
(362, '1935-03-16'),
(363, '1941-08-30'),
(364, '1931-04-13'),
(365, '1935-03-28'),
(366, '1937-04-26'),
(367, '1938-05-26'),
(368, '2021-08-24'),
(369, '1939-04-19'),
(370, '1940-04-04'),
(371, '2021-10-15'),
(372, '1935-07-23'),
(373, '1936-03-04'),
(374, '1936-12-30'),
(375, '1933-10-18'),
(376, '1934-11-10'),
(377, '2028-05-18'),
(378, '1942-05-27'),
(379, '1940-04-19'),
(380, '1930-10-01'),
(381, '1934-02-20'),
(382, '1935-12-26'),
(383, '1931-05-19'),
(384, '1930-01-16'),
(385, '1935-12-21'),
(386, '1930-08-05'),
(387, '1931-09-24'),
(388, '1942-06-27'),
(389, '1930-07-12'),
(390, '1938-01-12'),
(391, '1936-09-07'),
(392, '1943-03-13'),
(393, '1943-04-26'),
(394, '1934-12-25'),
(395, '1942-10-26'),
(396, '1933-04-27'),
(397, '1933-11-08'),
(398, '1931-04-14'),
(399, '1933-03-23'),
(400, '1933-07-27'),
(401, '1936-12-26'),
(402, '1937-10-23'),
(403, '2027-04-20'),
(404, '1930-06-12'),
(405, '1936-04-05'),
(406, '1937-10-12'),
(407, '1937-10-09'),
(408, '1937-02-09'),
(409, '1935-11-30'),
(410, '1938-09-25'),
(411, '2020-12-09'),
(412, '1939-01-07'),
(413, '1938-07-04'),
(414, '1941-07-11'),
(415, '1932-04-30'),
(416, '1931-05-18'),
(417, '1932-11-30'),
(418, '1932-02-29'),
(419, '2027-08-18'),
(420, '2021-09-22'),
(421, '1943-05-15'),
(422, '1934-04-17'),
(423, '1935-08-30'),
(424, '2027-10-04'),
(425, '1933-03-04'),
(426, '1934-01-20'),
(427, '2017-10-30'),
(428, '1930-10-07'),
(429, '2018-10-06'),
(430, '1934-04-10'),
(431, '2017-01-26'),
(432, '1934-01-15'),
(433, '2019-10-28'),
(434, '2028-01-01'),
(435, '2028-10-01'),
(436, '1930-01-21'),
(437, '1930-07-06'),
(438, '2026-07-10'),
(439, '1932-11-18'),
(440, '1935-07-23'),
(441, '1932-06-25'),
(442, '2010-04-30'),
(443, '1934-01-31'),
(444, '2026-10-17'),
(445, '1937-10-18'),
(446, '1932-07-10'),
(447, '1932-12-03'),
(448, '2026-05-15'),
(449, '2021-01-10'),
(450, '1941-07-01'),
(451, '2020-10-08'),
(452, '1945-09-03'),
(842, '1996-02-07'),
(453, '1936-11-01'),
(454, '1942-02-14'),
(455, '2026-07-04'),
(456, '2022-05-12'),
(457, '1936-12-09'),
(458, '2029-06-13'),
(459, '1931-07-20'),
(460, '1936-07-25'),
(461, '1930-01-25'),
(462, '1933-07-29'),
(463, '2025-12-29'),
(464, '1937-02-02'),
(465, '1938-01-05'),
(466, '2027-07-28'),
(467, '2023-04-15'),
(468, '1937-02-20'),
(469, '2026-05-11'),
(470, '1938-02-22'),
(471, '1937-01-30'),
(472, '1939-05-25'),
(473, '1937-09-30'),
(474, '2020-06-01'),
(475, '2029-09-17'),
(476, '2028-05-04'),
(477, '1932-02-08'),
(478, '2028-02-23'),
(479, '1932-02-25'),
(480, '1934-08-18'),
(481, '1932-12-16'),
(482, '2024-01-12'),
(483, '2021-10-02'),
(484, '2023-03-24'),
(485, '1934-01-28'),
(486, '2013-03-15'),
(487, '1935-07-28'),
(488, '1934-06-07'),
(489, '1933-03-26'),
(490, '2023-03-29'),
(491, '2020-04-05'),
(492, '1930-01-04'),
(493, '1940-06-10'),
(494, '2028-01-12'),
(495, '2018-11-01'),
(496, '2014-08-10'),
(497, '1934-01-14'),
(498, '2022-10-05'),
(499, '2019-09-30'),
(500, '2028-04-02'),
(501, '2021-06-29'),
(502, '1933-08-29'),
(503, '2021-06-04'),
(504, '2024-10-28'),
(505, '1937-12-02'),
(506, '1931-05-18'),
(507, '2023-11-29'),
(508, '1936-02-24'),
(509, '2028-07-16'),
(510, '2025-10-02'),
(511, '2020-06-02'),
(512, '2022-04-09'),
(513, '2019-02-10'),
(514, '2026-11-01'),
(515, '2028-04-04'),
(516, '2024-04-04'),
(517, '2029-01-19'),
(518, '2013-05-05'),
(519, '2018-08-31'),
(520, '2026-01-28'),
(521, '2019-10-15'),
(522, '2024-09-04'),
(523, '2019-08-12'),
(524, '1932-12-05'),
(525, '2026-01-28'),
(526, '1930-03-11'),
(527, '2027-05-28'),
(528, '2025-03-25'),
(529, '2016-09-12'),
(530, '1934-12-09'),
(531, '1935-01-16'),
(532, '2025-11-19'),
(533, '2026-08-19'),
(534, '2016-06-15'),
(535, '2027-07-04'),
(536, '2025-08-09'),
(537, '2024-01-06'),
(538, '2027-03-15'),
(539, '2027-03-11'),
(540, '1934-04-24'),
(541, '2023-06-16'),
(542, '1930-12-02'),
(543, '2023-02-19'),
(544, '2026-08-08'),
(545, '1932-03-17'),
(546, '2015-03-23'),
(547, '2018-09-20'),
(548, '2019-12-14'),
(549, '2023-06-06'),
(550, '2022-02-05'),
(551, '2026-11-11'),
(552, '2023-01-07'),
(553, '2026-04-13'),
(554, '2021-02-16'),
(555, '2014-04-10'),
(556, '2024-08-28'),
(557, '2026-05-30'),
(558, '2020-04-11'),
(559, '2026-01-06'),
(560, '2027-06-12'),
(561, '2015-10-26'),
(562, '2020-02-12'),
(563, '2023-04-03'),
(564, '2023-01-21'),
(565, '2020-02-08'),
(566, '2023-01-11'),
(567, '1938-03-25'),
(568, '2022-12-26'),
(569, '1934-10-16'),
(570, '1933-09-04'),
(571, '2021-06-12'),
(572, '2029-06-13'),
(573, '2028-07-10'),
(574, '2018-02-22'),
(575, '1932-05-05'),
(576, '2016-06-12'),
(577, '2024-07-28'),
(578, '2029-04-10'),
(579, '2011-06-24'),
(580, '2021-03-21'),
(581, '1931-11-06'),
(582, '2023-12-12'),
(583, '2028-08-10'),
(584, '1936-03-23'),
(585, '2016-11-12'),
(586, '2013-10-27'),
(587, '1930-10-28'),
(588, '1932-05-05'),
(589, '1899-08-03'),
(590, '1930-04-20'),
(591, '2024-10-24'),
(592, '2029-11-17'),
(593, '2018-07-04'),
(594, '2017-10-22'),
(595, '1933-04-24'),
(596, '2026-12-09'),
(597, '2028-10-09'),
(598, '1932-11-15'),
(599, '2026-11-10'),
(600, '2028-08-04'),
(601, '2018-04-16'),
(602, '2017-02-26'),
(603, '2019-05-06'),
(604, '2021-04-26'),
(605, '1934-06-24'),
(606, '2028-10-11'),
(607, '1932-10-21'),
(608, '1930-10-10'),
(609, '2020-01-05'),
(610, '2020-12-16'),
(611, '2014-07-13'),
(612, '2022-04-05'),
(613, '2021-02-22'),
(614, '1930-09-23'),
(615, '2013-08-21'),
(616, '2028-07-15'),
(617, '1932-09-13'),
(618, '2027-06-23'),
(619, '2014-01-19'),
(620, '2028-06-05'),
(621, '2029-03-28'),
(622, '2007-07-14'),
(623, '2024-07-11'),
(624, '2025-12-07'),
(625, '2014-02-28'),
(626, '2017-04-12'),
(627, '2005-11-05'),
(628, '2026-05-20'),
(629, '2016-02-06'),
(630, '2013-04-10'),
(631, '2020-06-15'),
(632, '2017-01-30'),
(633, '2009-05-16'),
(634, '2009-11-11'),
(635, '2028-05-19'),
(636, '2028-05-01'),
(637, '2027-05-13'),
(638, '2017-12-07'),
(639, '2028-12-09'),
(640, '2014-05-18'),
(641, '2006-10-12'),
(642, '2006-10-30'),
(643, '2024-12-03'),
(644, '2029-05-22'),
(645, '2020-09-04'),
(646, '2022-02-22'),
(647, '2018-07-13'),
(648, '2010-09-16'),
(649, '2024-01-07'),
(650, '2022-07-02'),
(651, '2019-09-02'),
(652, '2028-11-01'),
(653, '2029-08-08'),
(654, '2020-02-16'),
(655, '2014-04-29'),
(656, '2018-01-24'),
(657, '2018-12-13'),
(658, '2019-10-08'),
(659, '2029-01-29'),
(660, '2016-08-11'),
(661, '2012-10-07'),
(662, '1930-06-16'),
(663, '2016-03-21'),
(664, '2020-09-21'),
(665, '2022-08-14'),
(666, '2018-10-16'),
(667, '2017-08-04'),
(668, '2017-04-25'),
(669, '2014-07-15'),
(670, '2023-12-19'),
(671, '2007-08-05'),
(672, '2023-06-05'),
(673, '2021-10-02'),
(674, '2026-10-23'),
(675, '2021-10-20'),
(676, '2018-10-12'),
(677, '2010-10-08'),
(678, '2011-07-25'),
(679, '2021-02-19'),
(680, '2026-10-30'),
(681, '2018-09-14'),
(682, '2028-07-26'),
(683, '2016-06-23'),
(684, '2009-04-01'),
(685, '2024-01-17'),
(686, '2011-07-02'),
(687, '2014-11-12'),
(688, '2020-07-18'),
(689, '2019-11-20'),
(690, '2029-06-26'),
(691, '2009-04-06'),
(692, '2013-05-13'),
(693, '2018-07-10'),
(694, '2025-03-10'),
(695, '2013-08-17'),
(696, '2029-07-22'),
(697, '2003-06-09'),
(698, '2023-06-28'),
(699, '2013-03-02'),
(700, '2014-07-03'),
(701, '2007-12-18'),
(702, '2028-10-04'),
(703, '1898-11-01'),
(704, '2004-10-08'),
(705, '2020-02-16'),
(706, '1931-03-06'),
(707, '2029-07-15'),
(708, '2020-04-30'),
(709, '2003-05-23'),
(710, '2007-03-30'),
(711, '2017-03-06'),
(712, '2022-02-13'),
(713, '2023-02-10'),
(714, '2021-11-05'),
(715, '2021-12-21'),
(716, '2012-07-17'),
(717, '2000-12-27'),
(718, '2007-07-04'),
(719, '2008-02-28'),
(720, '2018-10-06'),
(721, '2010-03-30'),
(722, '2021-03-06'),
(723, '2012-04-19'),
(724, '2006-01-25'),
(725, '2013-03-21'),
(726, '2006-08-16'),
(727, '2023-06-06'),
(728, '2025-05-23'),
(729, '2009-03-06'),
(730, '2017-06-22'),
(731, '2013-06-14'),
(732, '2015-01-29'),
(733, '2002-07-19'),
(734, '2025-08-26'),
(735, '2027-06-07'),
(736, '2013-02-21'),
(737, '2008-04-11'),
(738, '2020-02-03'),
(739, '2015-06-23'),
(740, '2006-07-24'),
(741, '1896-12-28'),
(742, '2016-08-19'),
(743, '2019-11-04'),
(744, '2017-12-05'),
(745, '2022-04-15'),
(746, '2016-07-22'),
(747, '2009-12-28'),
(748, '2006-10-04'),
(749, '2000-03-29'),
(750, '1899-10-15'),
(751, '2022-07-11'),
(752, '2015-11-29'),
(753, '2019-10-28'),
(754, '2009-01-01'),
(755, '2002-04-27'),
(756, '2011-06-20'),
(757, '2014-09-16'),
(758, '2019-08-23'),
(759, '2019-10-02'),
(760, '1899-10-13'),
(761, '2020-01-16'),
(762, '2008-06-05'),
(763, '2011-03-28'),
(764, '2010-08-10'),
(765, '2010-01-25'),
(766, '2010-09-07'),
(767, '2011-03-04'),
(768, '2006-05-26'),
(769, '2027-12-15'),
(770, '2019-09-30'),
(771, '2011-12-30'),
(772, '2015-09-14'),
(773, '2005-12-22'),
(774, '2007-04-12'),
(775, '2021-05-20'),
(776, '2013-03-13'),
(777, '2007-09-22'),
(778, '2015-01-28'),
(779, '2014-05-10'),
(780, '2016-09-15'),
(781, '2011-08-21'),
(782, '2003-11-23'),
(783, '2005-07-25'),
(784, '2017-12-29'),
(785, '2021-05-11'),
(786, '1898-06-09'),
(787, '2006-07-06'),
(788, '2015-10-26'),
(789, '2015-03-24'),
(790, '2012-03-22'),
(791, '1898-08-18'),
(792, '2012-10-21'),
(793, '2006-08-31'),
(794, '2012-04-14'),
(795, '2012-06-17'),
(796, '2013-12-15'),
(797, '2020-09-04'),
(798, '2014-02-14'),
(799, '2010-07-25'),
(800, '2011-10-11'),
(801, '2009-08-27'),
(802, '2009-07-22'),
(803, '2008-01-31'),
(804, '2018-09-18'),
(805, '2017-02-10'),
(806, '2023-11-10'),
(807, '1987-08-19'),
(808, '1984-09-08'),
(810, '1984-08-11'),
(811, '1983-10-15'),
(812, '1984-01-19'),
(813, '1985-03-09'),
(814, '1986-04-16'),
(815, '1990-01-26'),
(816, '1985-12-27'),
(817, '1989-07-01'),
(818, '1990-04-25'),
(819, '1990-02-15'),
(820, '1991-04-21'),
(821, '1991-08-05'),
(822, '1989-08-28'),
(823, '1985-04-25'),
(824, '1989-08-03'),
(825, '1992-10-05'),
(826, '1994-04-26'),
(827, '1981-11-19'),
(828, '1990-09-02'),
(829, '1991-06-28'),
(830, '1997-09-30'),
(831, '1992-08-21'),
(832, '1994-09-01'),
(833, '1991-03-22'),
(834, '1991-09-25'),
(835, '1991-01-20'),
(836, '1994-10-18'),
(837, '1993-01-22'),
(838, '1992-03-26'),
(839, '1996-09-17'),
(840, '1998-10-29'),
(841, '1993-12-14'),
(843, '1989-11-10'),
(844, '1997-10-16'),
(845, '1995-08-27'),
(846, '1999-11-13'),
(847, '1998-02-15'),
(848, '1996-03-23'),
(849, '1995-06-29'),
(850, '1996-06-25'),
(851, '1995-09-23'),
(852, '2000-05-11'),
(853, '1999-03-02'),
(854, '1999-03-22');

/*Joined temp table and original drivers table on driver ID 
UPDATE drivers AS d 
SET dob_update = du.dob_update 
FROM drivers_update AS du
WHERE d."driverId" = du.driver_id;*/

--Testing. Drivers born before 1900 still needed to be cleaned. They were showing as being born in the wrong century.
--Had to exclude driver ID 852, only driver born after 2000.
SELECT "driverId",
	date_part('year', dob_update) AS year_dob,
	CASE WHEN date_part('year', dob_update) >= 2000 AND "driverId" != 852
	THEN dob_update - INTERVAL '100 years'
	ELSE dob_update END AS dobyear_update
FROM drivers
ORDER BY "driverId" DESC;

/*Updated drivers with query above.  
UPDATE drivers AS d 
SET dob_update = du.dobyear_update 
FROM (
		SELECT "driverId",
		date_part('year', dob_update) AS year_dob,
		CASE WHEN date_part('year', dob_update) >= 2000 AND "driverId" != 852
		THEN dob_update - INTERVAL '100 years'
		ELSE dob_update END AS dobyear_update
		FROM drivers
		ORDER BY "driverId" DESC
	) AS du
WHERE d."driverId" = du."driverId"; */

--Testing. Used to check update successful 
SELECT *
FROM drivers
ORDER BY dob_update;


--Combining race year, race ID, and drivers
--Created age of driver, based on birth year 
DROP TABLE driver_info IF EXISTS;

CREATE TEMP TABLE driver_info AS (
	SELECT 
		d."driverRef",
		d."driverId",
		d.dob_update,
		ds."raceId",
		ds.position,
		r.name,
		r.year,
		(r.year - date_part('year', d.dob_update)) AS age
	FROM drivers AS d
		JOIN driver_standings AS ds 
			ON d."driverId" = ds."driverId"
		JOIN races AS r
			ON ds."raceId" = r."raceId"
	ORDER by r.year DESC
)

--Testing. Checking points by age. 
SELECT SUM(t.points),
	   age
FROM (
	   SELECT di.*,
	          r.points
	   FROM driver_info di
	        JOIN results r 
		    ON di."driverId" = r."driverId"
		    	AND di."raceId" = r."raceId"
	) AS t
GROUP BY age;

--What is the min, max, average age of drivers?
SELECT min(age),
	max(age),
	avg(age)
FROM driver_info;

--Created two CTEs 1) to sum driver points and joining results table 2) creating "age buckets". 
--Neither CTE worked as intended. 
--Used code chunk below CTEs, which pulled from aspects of both CTEs to answer question.  
/*WITH driver_points AS(
	SELECT SUM(r.points) AS points_total,
			r."driverId",
			d.nationality
	FROM results AS r
		JOIN driver_info AS di
		ON r."driverId" = di."driverId"
		AND r."raceId" = di."raceId"
		JOIN drivers AS d
		ON r."driverId" = d."driverId"
	GROUP BY r."driverId", d.nationality
),
 
age_buckets AS (
	SELECT di."driverId",
			ds.points_total,
			age_buckets.quartile
	FROM driver_info AS di 
		JOIN (SELECT age,
					NTILE(4) OVER(ORDER BY age) AS quartile
			  FROM driver_info
			  GROUP BY age
			  ORDER BY quartile) AS age_buckets 
		ON di.age = age_buckets.age
		JOIN driver_points AS ds 
		ON di."driverId" = ds."driverId"
	ORDER BY age_buckets.quartile
)

--Testing. Another approach to finding out which age group has scored the most points.
SELECT COUNT(di."driverId") AS n_drivers,
	age_buckets.quartile,
	age_buckets.n_points 
FROM driver_info AS di
JOIN (SELECT SUM(r.points) AS n_points,
	  age,
	NTILE(4) OVER(ORDER BY age) AS quartile
	FROM driver_info AS di
	JOIN results AS r
	ON r."driverId" = di."driverId" AND
	  r."raceId" = di."raceId"
	GROUP BY age
	ORDER BY quartile) AS age_buckets 
ON di.age = age_buckets.age
GROUP BY age_buckets.quartile, age_buckets.n_points 
ORDER BY age_buckets.n_points;*/

--Driver points per age bucket: do younger or older drivers score more points? 
SELECT SUM(t.points),
	   t.quartile,
	   t.age_ranges
FROM (
		SELECT di.*,
			   r.points,
			   ab.quartile,
			   CASE WHEN ab.quartile = 1 THEN '18-28' 
			        WHEN ab.quartile = 2 THEN '29-38'
					WHEN ab.quartile = 3 THEN '39-48'
					ELSE '49-59' 
			   END AS age_ranges
		FROM driver_info di
			JOIN results r ON di."driverId" = r."driverId"
				AND di."raceId" = r."raceId"
			JOIN (SELECT age,
							NTILE(4) OVER(ORDER BY age) AS quartile
					  FROM driver_info
					  GROUP BY age
					  ORDER BY quartile
				) AS ab
				ON di.age = ab.age
		) AS t
GROUP BY t.quartile, t.age_ranges;

--Are drivers, on average, getting younger?
SELECT AVG(age),
	   year
FROM driver_info
GROUP BY year
ORDER BY year DESC;

--What is the average age of podium winners?
SELECT AVG(age),
	   COUNT(rs.position) AS total_podiums
FROM results AS rs
	   JOIN driver_info AS di
       ON rs."driverId" = di."driverId"
           AND rs."raceId" = di."raceId"
WHERE rs.position IN ('1', '2', '3')
ORDER BY total_podiums DESC;

--What is the average age of race winners?
SELECT AVG(age),
	   COUNT(rs.position) AS total_podiums
FROM results AS rs
	   JOIN driver_info AS di
       ON rs."driverId" = di."driverId"
	       AND rs."raceId" = di."raceId"
WHERE rs.position IN ('1')
ORDER BY total_podiums DESC;





